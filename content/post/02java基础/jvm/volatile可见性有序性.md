参考https://zhuanlan.zhihu.com/p/138819184

用 volatile 修饰共享变量后，每个线程要操作变量时会从主内存中将变量拷贝到本地内存作为副本，当线程操作变量副本并写回主内存后，会通过 **CPU 总线嗅探机制**告知其他线程该变量副本已经失效，需要重新从主内存中读取。

volatile 的主要作用有两点：

* 保证变量的内存可见性

* 禁止指令重排序